Teleinfo Handler API
=====================

TeleinfoHandler is a PHP API to handle EDF teleinfo data flow, and manage real time events. The API permit to simlpy retrieves teleinfo packets using the design pattern observer / listener in different PHP threads.
To see teleinfo documentation : http://norm.edf.fr/pdf/HN44S812emeeditionMars2007.pdf

###How it works
To use the API you need to install pthreads PHP's driver (http://php.net/manual/en/pthreads.installation.php). Then you can create your observer class, TeleinfoHandlerObserverInterface implementation is mandatory for teleinfo handler observering.
TeleinfoHandler object reads the teleinfo buffer, and on each events (only RECEIVED for this version), creates a new thread and notify observers, giving teleinfo packet and event type. Then you will be able to follow up with your own code and the packet received. Packet is transmit with TeleinfoPacket object, provinding the packet string and some methods (see TeleinfoPacket.php class).

observer sample:

```
<?php
/**
 * TeleinfoHandlerObserver.php
 */

include_once 'TeleinfoHandler/TeleinfoHandlerObserverInterface.php';

use TeleinfoHandler\TeleinfoHandlerObserverInterface as ObserverInterface;
use TeleinfoHandler\TeleinfoPacket as TeleinfoPacket;

/**
 * Teleinfo handler observer
 *
 * This class observes teleinfo handler events. TeleinfoHandlerObserverInterface
 * implementation is mandatory for teleinfo handler observering.
 * 
 * @author     Gaël Le Moëllic <gael.lm@gmail.com>
 * @version    Release: 1.0
 * @since      Class available since Release 1.0
 */
class TeleinfoHandlerObserver implements ObserverInterface {
    
    /**
     * teleinfo event.
     *
     * @access private
     */
    private $_event;
    
    /**
     * teleinfo packet.
     *
     * @access private
     */
    private $_teleinfoPacket;
    
    /**
     * This method will be called on each teleinfo events, executed on a different
     * thread and is mandatory for TeleinfoHandlerObserverInterface implementation.
     * 
     * @access public
     */
    public function notify() {

        if ($this->_event === self::EVENT_RECEIVED) {
            $this->onReceivedEvent();
        }
    }
    
    /**
     * This method permit to set the teleinfo handler event cause and is mandatory for
     * TeleinfoHandlerObserverInterface implementation.
     * 
     * @param string $event event string generated by the teleinfo handler
     * 
     * @access public
     */
    public function setTeleinfoEvent($event) {
        $this->_event = $event;
    }

    /**
     * This method permit to set the teleinfo handler packet and is mandatory for
     * TeleinfoHandlerObserverInterface implementation.
     * 
     * @param TeleinfoPacket $teleinfoPacket packet received by the teleinfo handler
     * 
     * @access public
     */
    public function setTeleinfoPacket(TeleinfoPacket $teleinfoPacket) {
        $this->_teleinfoPacket = $teleinfoPacket;
    }

    /**
     * This method will be called when the observer is notify by a RECEIVED event.
     *
     * @access private
     */
    private function onReceivedEvent() {
        
        //do something
        print($this->_teleinfoPacket->getTeleinfoPacketJson()."\xA");
    }
    
}
```

Then to use your observer. See the following instantiation sample :

```
<?php

include_once 'TeleinfoHandler/TeleinfoHandler.php';
include_once 'TeleinfoHandlerObserver.php';

use TeleinfoHandler\TeleinfoHandler as TeleinfoHandler;

$obs = new TeleinfoHandlerObserver();

$handler = new TeleinfoHandler('/dev/ttyAMA0');
$handler->addObserver($obs);
$handler->run();
```

###Dependencies
Tested with:
* PHP 5.6.5